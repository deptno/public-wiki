- [[../ai|ai]]
  - multi workspace agent 
    - turn-key 작업을 mcp를 통해서 타 에이전트 툴을 호출하는 방법도 가능할 것 같음
    - [[../mcp|mcp]] 이지만 [[../codex|codex]] 등을 래핑한 형태
    - [[../opencode|opencode]] 등도 지원하지만 agent 시스템이 플러그인 형태로 종속된다는 문제가있음
      - agent 는 prompt + tool + permissions 정도 설정이면 충분한데 과도하게 코드와 엉켜서 관리되지 않고 이식성이 거의 없는 문제가있음
  - [[../git|git]] worktree
    - .worktrees/ 사용
    - context 에 .worktrees/ 어디를 사용하는 명시 필요, session 단위
  - worktree 는 git 으로 관리되지 않거나 submodule 에 대해서는 자동 init 처리를 하지 않는다
  - worktree로 생성된 브랜치는 다른 main을 포함한 워크트리에서 checkout 할수 없다
  - codex-app 의 경우는 worktree 를 지원하나 지정한 폴더에 생성되는 구조에서 실행되는구조다
  - worktree 사용시의 문제점
    - skill, 혹은 `AGETNS.md` 파일을 통해 동적 worktree 를 강제하는 경우
      - workspace 밖으로 나가면 컨트롤이 어려워진다
      - worktree 를 workspace 안에서 생성하는 경우 e.g. `./.worktrees/...`
        - worktree 밖의 루트 파일을 수정할 가능성에 대해서 `AGENTS.md` 를 포함한 context에 의지할 수 밖에없다
  - worktree 문제점을 극복하기 위한 방법
    - codex 와 마찬가지로 worktree 를 먼저 생성후 거기서 [[../codex|codex]] 를 실행하는 방법
      - coding agent (e.g. [[../codex|codex]]) 를 실행을 [[../shell-script|shell-script]] 로 warp 해서 사용한다
      - 즉 codex-app 의 사용성과 마찬가지로 워크트리를 만들면서 필요한 작업(untracked file 복사)등을 함께 수행후 해당 폴더에서 coding agent 를 사용한다
      - 단점
        - git submodules 와 같은 것들은 init되지 않는다, untracked file 등 임시적인 환경을 위해 존재하는 파일들은 copy되지 않는다
  - `AGENTS.md` 관리
    - root `AGENTS.md` 를 간결하게 유지하면서 동적으로 다른 instruction 파일들을 로딩할 수 있도록 한다
      - skill 과 유사하며 skill로 대체되는지 의문
    - 명확하지 않거나 여러 인스트럭션을 읽으면서 붉명확해지거나 중복되는 것들은 주기적으로 정리할 수 있도록 프롬프트를 수행한다
    - [ ] **실험** skill 이나 타 instruction 이 로드되는경우 이를 context 에 알리도록 구성하는 것이 좋아보인다 
      - [ ] 이를 통해서 동적으로 해당 스킬이 더이상 필요없을때 지울수있는지여부도 중요해보임
  - 작업의 전달
    - 하고자 하는 markdown을 특정 폴더에 커밋하는 형태로 작업을 하면 어떨까?
    - `[feature-name].md` 이 worktree 로 브랜치되며 작업을 실행하는 형태다
    - 타 에이전트 인스턴스에서는 `git worktree list` 를 통해서 해당 스펙의 작업중 여부를 알 수 있다.
    - 혹은 openspec 처럼 `spec/{todo,wip.done}/[feateaure-name]`형태를 사용해도 좋을 것 같다 이 때는 main브랜치에서 커밋되어 세마포어 스타일의 역할을 하게 된다
  - worktree 마다 [[../docker-compose|docker-compose]] 등의 실행을 통한 ui 접근 허용 여부
    - 허용시에 눈에 보이는 디버깅 효과를 agent 로 누리게되므로 장점이 많다
    - [ ] worktree 별 포트 분배가 필요한 문제를 해결해야한다
