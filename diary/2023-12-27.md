- [ ] [[ios]] [[testflight]]
- [ ] [[firebase]] crashlytics
- [ ] [[fastlane]]
  - [ ] firebase-app-distribution
    - [ ] ios
      ```sh 
      Missing authentication credentials. Set up Application Default Credentials, your Firebase refresh token, or sign in with the Firebase CLI, and try again.
      ```
      - `fastlane/FastFile` ì—ì„œ ì¸ìë¡œ ì¸ì¦í‚¤ ìœ„ì¹˜ ì…ë ¥
        ```sh 
        the server responded with status 403
        ```
        + ~~https://stackoverflow.com/a/77438947~~
        + https://stackoverflow.com/questions/62385911/firebase-app-distribution-failed-to-fetch-app-information-403-the-caller-do
      - êµ¬ê¸€ í´ë¼ìš°ë“œ ì½˜ì†” ->  í”„ë¡œì íŠ¸ ->  IAM -> ì„œë¹„ìŠ¤ê³„ì •ì— firebase ë°°í¬ì— ì‚¬ìš©ë˜ëŠ” ê³„ì • ì´ë©”ì¼ ì„ íƒ -> **Firebase ì•± ë°°í¬** role ì¶”ê°€
        ```sh 
        the server responded with status 404
        ```
        - firebase console -> Release & Monitor ì—ì„œ ì„œë¹„ìŠ¤ê°€ ì‹œì‘ëœ ê²ƒì¸ì§€ í™•ì¸(ëŒ€ì‹œë³´ë“œê°€ ë³´ì—¬ì•¼í•¨)
          - android / ios ë¥¼ **ë³„ë„ë¡œ ì„¤ì •**í•´ì•¼í•˜ë‹ˆ ì´ ë¶€ë¶„ì— ìœ ì˜
      - ë©”ì¼ë„ ì˜¤ê³  í…ŒìŠ¤íŠ¸ë„ ë“±ë¡ë˜ì—ˆìœ¼ë‚˜ ë‹¤ìš´ë¡œë“œ ë¶ˆê°€ 
        ```txt 
        ê¸°ê¸°ê°€ë“±ë¡ë˜ì—ˆìœ¼ë©°ì´ì œì¤€ë¹„ê°€ëë‚¬ìŠµë‹ˆë‹¤
        ì•±ì„í…ŒìŠ¤íŠ¸í• ì¤€ë¹„ê°€ë˜ë©´ì´ë©”ì¼ì´ì „ì†¡ë©ë‹ˆë‹¤.
        ```
        + https://firebase.google.com/codelabs/appdistribution-udid-collection?hl=ko#2
          ```sh 
          [14:00:01]: ------------------------------
          [14:00:01]: --- Step: default_platform ---
          [14:00:01]: ------------------------------
          [14:00:01]: ----------------------------------------------
          [14:00:01]: --- Step: git log -1 --oneline | tr -d '
          ' ---
          [14:00:01]: ----------------------------------------------
          [14:00:01]: $ git log -1 --oneline | tr -d '
          '
          [14:00:01]: â–¸ 8e0f3c19 fastlane: firebase ë°°í¬ì‹œì— í…ŒìŠ¤í„° ê·¸ë£¹ ì§€ì •
          [14:00:01]: Driving the lane 'ios firebase' ğŸš€
          [14:00:01]: ------------------------------
          [14:00:01]: --- Step: get_certificates ---
          [14:00:01]: ------------------------------

          +-----------------------------------------------------------------------------+
          |                          Summary for cert 2.217.0                           |
          +-------------------------+---------------------------------------------------+
          | development             | false                                             |
          | force                   | false                                             |
          | generate_apple_certs    | true                                              |
          | username                | deptno@gmail.com                                  |
          | team_id                 | xxxxxxxxxx                                        |
          | keychain_path           | xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx |
          | skip_set_partition_list | false                                             |
          | platform                | ios                                               |
          +-------------------------+---------------------------------------------------+

          [14:00:01]: Starting login with user 'deptno@gmail.com'
          -------------------------------------------------------------------------------------
          Please provide your Apple Developer Program account credentials
          The login information you enter will be stored in your macOS Keychain
          You can also pass the password using the `FASTLANE_PASSWORD` environment variable
          See more information about it on GitHub: https://github.com/fastlane/fastlane/tree/master/credentials_manager
          -------------------------------------------------------------------------------------
          Password (for deptno@gmail.com): ***********
          security: SecKeychainAddInternetPassword <NULL>: The specified item already exists in the keychain.
          Could not store password in keychain
          Available session is not valid any more. Continuing with normal login.
          [14:00:10]: Successfully logged in
          [14:00:11]: Found the certificate xxxxxxxxxx (Bonggyun Lee) which is installed on the local machine. Using this one.
          [14:00:11]: Verifying the certificate is properly installed locally...
          [14:00:11]: Successfully installed certificate xxxxxxxxxx
          [14:00:11]: Use signing certificate 'xxxxxxxxxx' from now on!
          ```
          + https://developer.apple.com
          - ì¸ì¦ì„œ ìƒì„±ëœ ê²ƒ í™•ì¸ ê°€ëŠ¥ TYPE: **Distribution**
          - í”„ë¡œíŒŒì¼ ìƒì„±ëœ ê²ƒ í™•ì¸ ê°€ëŠ¥ TYPE: **Ad hoc**
          - ì´í›„ ë°°í¬ë˜ëŠ” ê²ƒë“¤ì—ëŒ€í•´ì„œëŠ” ë‹¤ìš´ë¡œë“œ í™•ì¸ë¨
          - ì¶”ê°€ì ì¸ ë””ë°”ì´ìŠ¤ê°€ í•„ìš”í•œ ê²½ìš°ì—ëŠ” ë””ë°”ì´ìŠ¤ ì¶”ê°€í•´ì„œ ì§„í–‰
          - [ ] ì—¬ëŸ¬ ê¸°ê¸°ì—ì„œ ë¹Œë“œê°€ í•„ìš”í•œ ê²½ìš°ì—ëŠ” [[match]] í•„ìš”
        - [[../udid|udid]] ë“±ë¡í™•ì¸
  - [[../ios|ios]]
    ```sh 
    bundle exec fastlane init
    ```
    - **Automate beta distribution to TestFlight** ì„ íƒ
    - ë¬¸ì„œ `Podfile` ì— UTF-8 ì„¤ì •ì„ ìš”êµ¬í•˜ê³  ìˆìŒ
    ```ruby 
    export LC_ALL=en_US.UTF-8
    export LANG=en_US.UTF-8
    ```
      + https://docs.fastlane.tools/getting-started/ios/setup/
  - [ ] ì¸ì¦
    - *App Store Connect API Key* ë¥¼ ê¶Œì¥í•˜ë‚˜ fastlane ì—ì„œ `produce`, `pem` action í˜¹ì€ tool ì„ ì§€ì›í•˜ì§€ ëª»í•œë‹¤
      + https://appstoreconnect.apple.com/access/api
      - *App Store Connect API ì•¡ì„¸ìŠ¤ ìš”ì²­*  -> ë°”ë¡œ ìŠ¹ì¸ë¨
      - *API í‚¤ ìƒì„±* role ì€ **ì•± ê´€ë¦¬** ë¡œ ì¤˜ë´„
        ```sh 
        [01:36:03]: âœ…  Logging in with your Apple ID was successful
        [01:36:03]: Checking if the app '[BUNDLE_ID]' exists in your Apple Developer Portal...
        [01:36:04]: âœ…  Your app '[BUNDLE_ID]' is available in your Apple Developer Portal
        [01:36:04]: Checking if the app '[BUNDLE_ID]' exists on App Store Connect...
        [01:36:04]: Looks like the app '[BUNDLE_ID]' isn't available on App Store Connect
        [01:36:04]: for the team ID '126815971' on Apple ID 'deptno@gmail.com'
        [01:36:04]: Would you like fastlane to create the App on App Store Connect for you? (y/n)
        ```
      - ìƒì„±í•´ì£¼ê¸°ë„ í•˜ëŠ”ë° ì§ì ‘ìƒì„±í•˜ê¸°ë¡œí•œë‹¤
        - SKU ëŠ” ê³ ìœ  ì•„ì´ë””ë¡œ ë…¸ì¶œë˜ì§€ ì•ŠëŠ”ë‹¤ `AAAA_0001` ì´ëŸ°ì‹ìœ¼ë¡œ ìƒì„±ì´ ê°€ëŠ¥
      - ì•±ìƒì„±í›„ì— `fastlane init` ì„ ì´ì–´ê°€ë©´ `Gemfile`ê³¼ í•¨ê»˜ `fastlane/{App,Fast}File` ì´ ìƒì„±ëœë‹¤
      - `bundle exec fastlane beta` achive ì´ í›„ ì—ëŸ¬ê°€ ë°œìƒ
        ```sh 
        [02:04:08]: â–¸ Archive Succeeded
        # ...
        error: exportArchive: No profiles for '[BUNDLE_ID]' were found

        Error Domain=IDEProfileLocatorErrorDomain Code=1 "No profiles for '[BUNDLE_ID]' were found" UserInfo={IDEDistributionIssueSeverity=3, NSLocalizedDescription=No profiles for '[BUNDLE_ID]' were found, NSLocalizedRecoverySuggestion=Xcode couldn't find any iOS App Store provisioning profiles matching '[BUNDLE_ID]'. Automatic signing is disabled and unable to generate a profile. To enable automatic signing, pass -allowProvisioningUpdates to xcodebuild.}

        ** EXPORT FAILED **
        [02:04:19]: Exit status: 70

        # ...

        [02:04:20]: fastlane finished with errors

        [!] Error packaging up the application
        ```
        - **Provisioning Profile** ì´ ì—†ì–´ì„œ ë‚˜ëŠ” ì—ëŸ¬ë¡œ ë””í„ë¡œí¼ ì½˜ì†”ì—ì„œ ìƒì„±í•˜ë©´ëœë‹¤ **ê°œë°œëª©ì ê³¼ ë°°í¬ëª©ì ì´ ë”°ë¡œ í•„ìš”**í•œë° ì—¬ê¸°ì„  testflight **ë°°í¬** ëª©ì ì´ë‹ˆ **Ad Hoc** ìœ¼ë¡œ ìƒì„±
          - [ ] ìƒì„± í›„ *Automatically manage signing* ì„ ì²´í¬ í•´ì œí•˜ê³  *Download Profile* ì„ ì„ íƒí•´ì„œ ë°©ê¸ˆ ìƒì„±í•œ í”„ë¡œíŒŒì¼ì„ ì„ íƒ
          - [X] ìˆ˜ë™ì€ ì•Œì•„ë§Œ ë‘ê³  ìë™ìœ¼ë¡œí•œë‹¤
        - *App Store Connect API Key*ë¥¼ lane ì•ˆì— ì¶”ê°€
          ```sh 
          api_key = app_store_connect_api_key(
            key_id: "[API KEY ID]",
            issuer_id: "[API KEY ISSUER]",
            key_filepath: "./[ìƒì„±í•œ API KEY].p8",
            duration: 1200, # optional (maximum 1200)
            in_house: false # optional but may be required if using match/sigh
          )
          ```
        - ë¹Œë“œ í›„ icon ì—ëŸ¬
          ```sh 
          [04:02:20]: [altool] 2023-12-27 04:02:20.553 *** Error: Asset validation failed Missing required icon file. The bundle does not contain an app icon for iPhone / iPod Touch of exactly '120x120' pixels, in .png format for iOS versions >= 10.0. To support older versions of iOS, the icon may be required in the bundle outside of an asset catalog. Make sure the Info.plist file includes appropriate entries referencing the file. See https://developer.apple.com/documentation/bundleresources/information_property_list/user_interface (ID: e19b1052-837f-4d5a-b7a2-98a288cc04e5) (90022)
          [04:02:20]: [altool]  {
          [04:02:20]: [altool]     NSLocalizedDescription = "Asset validation failed";
          [04:02:20]: [altool]     NSLocalizedFailureReason = "Missing required icon file. The bundle does not contain an app icon for iPhone / iPod Touch of exactly '120x120' pixels, in .png format for iOS versions >= 10.0. To support older versions of iOS, the icon may be required in the bundle outside of an asset catalog. Make sure the Info.plist file includes appropriate entries referencing the file. See https://developer.apple.com/documentation/bundleresources/information_property_list/user_interface (ID: e19b1052-837f-4d5a-b7a2-98a288cc04e5)";
          [04:02:20]: [altool]     NSUnderlyingError = "Error Domain=IrisAPI Code=-19241 \"Asset validation failed\" UserInfo={status=409, detail=Missing required icon file. The bundle does not contain an app icon for iPhone / iPod Touch of exactly '120x120' pixels, in .png format for iOS versions >= 10.0. To support older versions of iOS, the icon may be required in the bundle outside of an asset catalog. Make sure the Info.plist file includes appropriate entries referencing the file. See https://developer.apple.com/documentation/bundleresources/information_property_list/user_interface, id=e19b1052-837f-4d5a-b7a2-98a288cc04e5, code=STATE_ERROR.VALIDATION_ERROR.90022, title=Asset validation failed, NSLocalizedFailureReason=Missing required icon file. The bundle does not contain an app icon for iPhone / iPod Touch of exactly '120x120' pixels, in .png format for iOS versions >= 10.0. To support older versions of iOS, the icon may be required in the bundle outside of an asset catalog. Make sure the Info.plist file includes appropriate entries referencing the file. See https://developer.apple.com/documentation/bundleresources/information_property_list/user_interface, NSLocalizedDescription=Asset validation failed}";
          [04:02:20]: [altool]     "iris-code" = "STATE_ERROR.VALIDATION_ERROR.90022";
          [04:02:20]: [altool] }

          [04:02:20]: Application Loader output above ^
          [04:02:20]: ERROR: [ContentDelivery.Uploader] Asset validation failed (90713) Missing Info.plist value. A value for the Info.plist key 'CFBundleIconName' is missing in the bundle 'ro.salji.app'. Apps built with iOS 11 or later SDK must supply app icons in an asset catalog and must also provide a value for this Info.plist key. For more information see http://help.apple.com/xcode/mac/current/#/dev10510b1f7. (ID: 88fadd26-4d5d-475c-a298-7a3ac144d52a)
          ```          
      - ì•„ì´ì½˜ ì£¼ì… testflight ì— ì˜¬ë¼ê°„ ê²ƒì€ í™•ì¸ ë˜ë‚˜ ì—ëŸ¬
        - `No build_beta_detail included`
      - appstoreconnect -> TestFlight -> ë² íƒ€ ì •ë³´ ì…ë ¥
      - ì´í›„ ì„±ê³µ

- appstoreconnect
  - [X] ë‚´ë¶€ í…ŒìŠ¤íŒ… ê·¸ë£¹ ìƒì„±
- firebase app distribution
  - [X] í…ŒìŠ¤íŒ… ê·¸ë£¹ ìƒì„±

- fastlane ë²„ì €ë‹ì´ xcodeproj ë¥¼ ê¸°ì¤€ìœ¼ë¡œ í•˜ë©´ì„œ íŒŒì¼ì´ ê³„ì† ë³€ê²½ë˜ì–´ ì»¤ë°‹í•´ì•¼í•˜ëŠ” ì´ìŠˆê°€ ìˆìŒ
  - *SharedValues* ì¡°ì‚¬
  - ë¹Œë“œ ë²ˆí˜¸ í˜•ì‹ ì¡°ì‚¬
