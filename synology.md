# synology

DSM7

## 인증서
### 발급

[[let's-encrypt]]

1. 공유기에서 80에 대한 포트포워딩이 있으면 제거한다.
2. nas 에서 인증서를 발급받는다. 도메인에 DNS 등록된 서브 도메인을 포함하여 넣는다. eg. `nas.deptno.dev`
3. 필요한 필드를 입력한다.  
  - 도메인 이름 - `제어판 -> 외부 엑세스 -> 고급` 과 일치시킨다.
  - 이메일
4. 공유기에서 DMZ 제거
5. 공유기에서 ~80~, 443 에 대한 포트포워딩을 다시 설정한다.
6. 제어판 -> 로그인 포털 설정
  1. 웹서비스  
     - DSM 포트 설정(5000, 5001)과 공유기의 포트포워딩을 맞춘다. 
     - 자동으로 HTTP 연결을 DSM 데스크톱의 HTTPS 로 리디렉션
  2. 도메인  
     - HSTS를 활성화하면 브라우저가 보안된 연결을 사용합니다.

80, 443 이 다이렉트로 접근되어야지 갱신이 가능한 것으로 보인다.

- [ ] [[@todo]] 갱신 타이밍에 확실히 확인해서 5000, 5001 포트 포워딩 제거가능을 확인하자.  
      `task dc290470-bf1c-41fb-b3b3-e2e91defe587`

**2022-03-25 업데이트**
- 갱신은 80 포트를 통해서 이루어진다. -> 공유기에서 따로 80포트에 대한 처리가 없어야한다.
- 443 포트는 https 서빙을 위해 포트 포워딩을 걸어둔다 443 -> 5001
- 제어판 -> 보안 -> 인증서 -> 갱신 이 성공해야한다.

#### history
- 2021/12/19 05:20:06 
- 2022/03/19 05:20:06 - 만료됨
- 2022/03/24 인증확인하고 접속 -> 갱신 실패
- 



## 스토리지 풀 제거
1. 데이터를 다른 스토리지 풀로 이동시킨다.  
   로그인 -> 제어판 -> 공유 폴더 -> 폴더 선택 -> 편집
   `위치`를 이동하고자 하는 볼륨으로 변경
2. 해당 스토리지풀에서 실행되는 패키지가 존재하지 않아야한다  
   주로 최초 스토리지인 경우가 이러한 경우 해당한다.
   내 경우에는 `web station` 이 실행 중이었는데 제거는 가능하지 않았고 중지는 가능했다.
   중지 후 관련 폴더 다른 스토리지 볼륨으로 이동하면 이동이 된다.
3. 저장소 관리자 -> 저장소 -> 스토리지 풀  
   볼륨 제거 후 스토리지 풀도 함께 삭제한다.
  
## related
- [[exiftool]]
- [[synology-photos]]
- [[ssh]]
- [[let's-encrypt]]
